version: '3.8'

services:
  chroma:
    image: chromadb/chroma:latest
    container_name: brainbot-chroma-test
    ports:
      - "8000:8000"
    environment:
      - IS_PERSISTENT=FALSE
      - ANONYMIZED_TELEMETRY=FALSE
    restart: unless-stopped

  redis:
    image: redis/redis-stack:latest
    container_name: brainbot-redis-test
    ports:
      - "6379:6379"
    environment:
      - REDIS_ARGS=--save 60 1
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 5s
      retries: 12
    restart: unless-stopped

# This compose file is intended as a lightweight test harness for integration
# tests that require Redis (with RedisBloom) and Chroma. Usage:
#
#   ./scripts/test-integration.sh
#
# The script will bring up the services, wait for Redis to be ready, run `go test`
# with REDIS_ADDR set to localhost:6379, then tear down the services.
