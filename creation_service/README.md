# Creation Service

Video processing and YouTube upload service.

## Overview

The creation service handles:
- Consuming video generation requests from Kafka
- Processing videos with FFmpeg (adding background, audio, subtitles)
- Uploading videos to YouTube with metadata
- Supporting multiple operation modes (API, Kafka, Batch)

## Setup

### Prerequisites

- Go 1.24+
- FFmpeg installed
- YouTube OAuth credentials
- Kafka running (for Kafka mode)

### YouTube OAuth Setup

Run the setup script:

```bash
cd scripts
./setup_creation_service_credentials.sh
```

This will:
1. Guide you through creating YouTube API credentials
2. Set up OAuth flow
3. Generate `.secrets/youtube.env` with tokens

### Environment Variables

```bash
# YouTube OAuth (generated by setup script)
YOUTUBE_CLIENT_ID=your_client_id
YOUTUBE_CLIENT_SECRET=your_client_secret
YOUTUBE_ACCESS_TOKEN=your_access_token
YOUTUBE_REFRESH_TOKEN=your_refresh_token
YOUTUBE_TOKEN_EXPIRY=expiry_timestamp

# Kafka configuration (for Kafka mode)
KAFKA_BOOTSTRAP_SERVERS=localhost:9093
KAFKA_TOPIC_VIDEO_REQUESTS=video-processing-requests
KAFKA_CONSUMER_GROUP_ID=creation-service-consumer-group
```

## Running Modes

### Kafka Consumer Mode (Default)

Continuously consumes video requests from Kafka:

```bash
# Load YouTube credentials
source .secrets/youtube.env

# Run in Kafka mode
go run main.go -kafka
```

### API Mode

Exposes HTTP API for video processing:

```bash
go run main.go -port :8081
```

API endpoint:
```bash
POST /api/process-video
Content-Type: application/json

{
  "script": "Video script text...",
  "video_url": "https://...",
  "audio_url": "https://...",
  "captions": [
    {"start": 0.0, "end": 2.5, "text": "Hello"},
    {"start": 2.5, "end": 5.0, "text": "World"}
  ],
  "title": "Video Title",
  "description": "Video description"
}
```

### Batch Mode

Process all JSON files from `inputs/` directory:

```bash
go run main.go -batch
```

## Build & Run

```bash
# Build
go build -o creation-service main.go

# Run in Kafka mode
./creation-service -kafka

# Run in API mode
./creation-service -port :8081

# Run in batch mode
./creation-service -batch
```

## Docker

```bash
# Build
docker build -t brainbot-creation .

# Run (Kafka mode)
docker run \
  -e KAFKA_BOOTSTRAP_SERVERS=kafka:9092 \
  -e YOUTUBE_REFRESH_TOKEN=your_token \
  brainbot-creation
```

## Troubleshooting

**FFmpeg errors:**
- Verify FFmpeg is installed: `ffmpeg -version`
- Check background videos exist in `backgroundvids/`

**YouTube upload errors:**
- Verify OAuth tokens: Re-run `./scripts/setup_creation_service_credentials.sh`
- Check YouTube API quota

**Kafka connection errors:**
- Verify Kafka is running
- Check topic exists in Kafka UI
